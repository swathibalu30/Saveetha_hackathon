<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Diagnosis - Automated Diagnostic System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .advanced-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3rem 2rem;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .advanced-header h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        
        .advanced-header p {
            margin: 1rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.95;
        }
        
        .ai-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .provider-selector {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9ff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .provider-option {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
        }
        
        .provider-option input[type="radio"] {
            margin-right: 0.5rem;
        }
        
        .provider-option label {
            margin: 0;
            font-weight: normal;
        }
        
        .badge-free {
            background: #28a745;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .badge-paid {
            background: #ffc107;
            color: #333;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .symptoms-input {
            min-height: 100px;
        }
        
        .feature-highlight {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .feature-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .feature-card h3 {
            margin: 0.5rem 0;
            color: #667eea;
        }
        
        .feature-card p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    {% include '_header.html' %}

    <div class="advanced-header">
    <h1><i class="fa fa-robot" aria-hidden="true"></i> Advanced AI-Powered Diagnosis</h1>
        <p>Combining Machine Learning, Large Language Models, and Medical Research</p>
        <div class="ai-badge">
            <i class="fa fa-bolt" aria-hidden="true"></i> Enhanced with LangChain &nbsp;|&nbsp; <i class="fa fa-book" aria-hidden="true"></i> PubMed Research &nbsp;|&nbsp; <i class="fa fa-globe" aria-hidden="true"></i> Real-time Medical Sources
        </div>
    </div>

    <div class="container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}" style="margin-bottom: 2rem; padding: 1rem; border-radius: 8px; {% if category == 'danger' %}background: #fee; border-left: 4px solid #c00; color: #c00;{% else %}background: #efe; border-left: 4px solid #0c0; color: #060;{% endif %}">
                        <strong>{% if category == 'danger' %}<i class="fa fa-times-circle"></i> Error:{% else %}<i class="fa fa-check-circle"></i> Success:{% endif %}</strong> {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- Feature Highlights -->
        <div class="feature-highlight">
            <div class="feature-card">
                <div class="feature-icon"><i class="fa fa-brain"></i></div>
                <h3>AI Analysis</h3>
                <p>Get differential diagnosis powered by advanced language models</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="fa fa-search"></i></div>
                <h3>Medical Research</h3>
                <p>Access PubMed articles and evidence-based information</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="fa fa-globe"></i></div>
                <h3>Web Sources</h3>
                <p>Real-time medical information from trusted sources</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon"><i class="fa fa-chart-line"></i></div>
                <h3>ML Integration</h3>
                <p>Combined with our trained Random Forest model</p>
            </div>
        </div>

        <!-- Diagnosis Form -->
        <div class="form-container">
            <h2>Patient Information</h2>
            
            <form action="{{ url_for('advanced_predict') }}" method="POST" id="advancedDiagnosisForm">
                <!-- AI Provider (hidden - defaults to Groq - Fast & Free) -->
                <input type="hidden" name="llm_provider" value="groq">

                <div class="form-group">
                    <label for="name">Patient Name:</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="age">Age:</label>
                        <input type="number" id="age" name="age" min="1" max="120" required>
                    </div>

                    <div class="form-group">
                        <label for="gender">Gender:</label>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bp">Blood Pressure (mmHg):</label>
                        <input type="number" id="bp" name="bp" min="60" max="200" required>
                    </div>

                    <div class="form-group">
                        <label for="glucose">Glucose Level (mg/dL):</label>
                        <input type="number" id="glucose" name="glucose" min="50" max="400" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="heart_rate">Heart Rate (bpm):</label>
                    <input type="number" id="heart_rate" name="heart_rate" min="40" max="200" required>
                </div>

                <div class="form-group">
                    <label for="symptoms">Symptoms (comma-separated):</label>
                    <textarea id="symptoms" name="symptoms" class="symptoms-input" 
                              placeholder="Enter symptoms separated by commas. Example: fever, headache, fatigue, chest pain" 
                              required></textarea>
                    <small style="color: #666;">Be specific! Example: "persistent headache, nausea, sensitivity to light, dizziness"</small>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fa fa-flask" aria-hidden="true"></i> Get Advanced Diagnosis
                </button>
            </form>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p style="margin-top: 1rem; color: #667eea;">
                    <strong>Analyzing patient data...</strong><br>
                    <small>Running ML model, querying medical databases, and generating AI analysis</small>
                </p>
            </div>
        </div>

        <!-- Information Section -->
        <div class="info-section" style="margin-top: 2rem; padding: 1.5rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
            <h3 style="margin-top: 0;">ℹ️ How Advanced Diagnosis Works</h3>
            <ol style="margin: 0.5rem 0;">
                <li><strong>ML Model Prediction:</strong> Our trained Random Forest model analyzes your vitals</li>
                <li><strong>AI Analysis:</strong> LangChain-powered LLM provides differential diagnosis and reasoning</li>
                <li><strong>PubMed Research:</strong> Searches latest medical research articles</li>
                <li><strong>Web Sources:</strong> Gathers information from trusted medical sources</li>
                <li><strong>Comprehensive Report:</strong> Combines all sources into actionable insights</li>
            </ol>
            <p style="margin: 1rem 0 0 0; font-size: 0.9rem;">
                <strong>⚠️ Disclaimer:</strong> This is an AI-assisted tool for educational purposes only. 
                Always consult qualified healthcare professionals for medical advice and treatment.
            </p>
        </div>
    </div>

    <script>
        // Show loading spinner on form submit
        document.getElementById('advancedDiagnosisForm').addEventListener('submit', function() {
            document.querySelector('.form-container form').style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'block';
        });

        // Validate symptoms input
        document.getElementById('symptoms').addEventListener('blur', function() {
            const symptoms = this.value.trim();
            if (symptoms && !symptoms.includes(',')) {
                alert('Please enter multiple symptoms separated by commas for better diagnosis.');
            }
        });
    </script>
    {% include '_footer.html' %}
</body>
</html>
